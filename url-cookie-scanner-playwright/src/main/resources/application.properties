# ==================== MULTI-TENANT MONGODB CONFIGURATION ====================

# Main MongoDB Connection URI (shared connection)
spring.data.mongodb.uri=mongodb://localhost:27017/url_cookie_scanner
# Multi-Tenant Configuration
multi-tenant.shared-database=shared_cookie_scanner
multi-tenant.tenant-database-prefix=tenant_db_
multi-tenant.default-tenant-id=default
multi-tenant.enable-tenant-isolation=true

# Additional MongoDB Settings for Multi-Tenant Setup
spring.data.mongodb.option.connections-per-host=25
spring.data.mongodb.option.max-connection-idle-time=60000
spring.data.mongodb.option.max-connection-life-time=120000
spring.data.mongodb.option.connect-timeout=10000
spring.data.mongodb.option.socket-timeout=30000
spring.data.mongodb.option.max-wait-time=5000

# MongoDB Connection Pool for Multi-Tenant
spring.data.mongodb.option.min-connections-per-host=5
spring.data.mongodb.option.threads-allowed-to-block-for-connection-multiplier=10

# ==================== ENHANCED ERROR HANDLING & PROTECTION ====================

# Server Configuration for High Load and DoS Protection
server.tomcat.max-threads=200
server.tomcat.min-spare-threads=10

# Request Size Limits (Prevent Large Payload Attacks)
spring.servlet.multipart.max-file-size=1MB
spring.servlet.multipart.max-request-size=1MB

# Connection Timeout Settings
server.connection-timeout=20000

# Enable HTTP response chunking
server.tomcat.use-body-encoding-for-uri=true
spring.http.encoding.enabled=true
spring.http.encoding.charset=UTF-8
spring.http.encoding.force=true

# ==================== RESPONSE SIZE CONFIGURATION ====================

# Maximum response body size
server.tomcat.max-http-post-size=52428800
server.tomcat.max-save-post-size=52428800

# Request and Response header sizes
server.max-http-header-size=10485760
server.tomcat.max-http-request-header-size=10485760

# Connection settings
server.tomcat.max-connections=10000
server.tomcat.accept-count=200
server.tomcat.connection-timeout=60000

# Buffer sizes for large responses
server.tomcat.socket-buffer=65536

# Compression (disable for large JSON responses)
server.compression.enabled=false



# ==================== CRITICAL: FORCE JSON ERROR RESPONSES ====================

# Error Response Configuration - FORCE JSON (NOT HTML)
server.error.include-stacktrace=never
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-exception=false
server.error.whitelabel.enabled=false

# CRITICAL: Force JSON for all error responses
spring.mvc.contentnegotiation.favor-parameter=false
spring.mvc.contentnegotiation.ignore-accept-header=false
spring.mvc.contentnegotiation.use-registered-extensions-only=true
spring.mvc.contentnegotiation.media-types.json=application/json

# ==================== CRITICAL: JACKSON CONFIGURATION FOR PROPER INSTANT SERIALIZATION ====================

# Jackson configuration for consistent JSON and proper timestamp formatting
spring.jackson.serialization.indent-output=false
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.serialization.write-date-timestamps-as-nanoseconds=false
spring.jackson.deserialization.fail-on-unknown-properties=true
spring.jackson.deserialization.read-date-timestamps-as-nanoseconds=false
spring.jackson.default-property-inclusion=non_null
spring.jackson.date-format=yyyy-MM-dd'T'HH:mm:ss.SSS'Z'
spring.jackson.time-zone=UTC

# HTTP message converters - prefer JSON
spring.http.converters.preferred-json-mapper=jackson

# ==================== ENHANCED TOMCAT SECURITY FOR PATH TRAVERSAL ====================

# Path character configuration - RESTRICTIVE for security
server.tomcat.relaxed-path-chars=
server.tomcat.relaxed-query-chars=

# Additional Tomcat security
server.tomcat.reject-illegal-header=true
server.tomcat.additional-tld-skip-patterns=*.jar
server.tomcat.mbeanregistry.enabled=false

# Security headers
server.servlet.session.timeout=30m
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=false
server.servlet.session.cookie.same-site=strict

# ==================== ENHANCED SCANNER CONFIGURATION FOR MAXIMUM DETECTION ====================

# Core Scanner Settings - Optimized for stability and rate limiting
scanner.maxRedirects=10
scanner.navTimeoutSeconds=15
scanner.navigationWait=networkidle
scanner.userAgent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36

# ==================== AGGRESSIVE INTERACTION SETTINGS ====================

# Enhanced User Interaction Simulation
scanner.interaction.enabled=true
scanner.interaction.scroll.enabled=true
scanner.interaction.click.enabled=true
scanner.interaction.delay.ms=1000
scanner.interaction.mouse.movement.enabled=true
scanner.interaction.keyboard.simulation.enabled=true
scanner.interaction.form.filling.enabled=true

# Advanced Consent Handling
scanner.consent.handling.enabled=true
scanner.consent.timeout.seconds=20
scanner.consent.retry.attempts=5
scanner.consent.aggressive.mode=true
scanner.consent.multilingual.detection=true

# ==================== EMBEDDED CONTENT PROCESSING ====================

# Comprehensive Embedded Content Processing
scanner.embedded.content.processing=true
scanner.iframe.processing.enabled=true
scanner.iframe.timeout.seconds=30
scanner.iframe.interaction.enabled=true
scanner.embed.processing.enabled=true
scanner.object.processing.enabled=true

# Third-Party Resource Loading
scanner.thirdparty.loading.enabled=true
scanner.thirdparty.timeout.seconds=15
scanner.thirdparty.aggressive.mode=true

# ==================== ANALYTICS AND TRACKING ====================

# Universal Analytics Triggering
scanner.analytics.trigger.enabled=true
scanner.analytics.google.enabled=true
scanner.analytics.facebook.enabled=true
scanner.analytics.adobe.enabled=true
scanner.analytics.mixpanel.enabled=true
scanner.analytics.hotjar.enabled=true
scanner.analytics.custom.events.enabled=true

# Advanced Event Triggering
scanner.events.dom.trigger.enabled=true
scanner.events.performance.trigger.enabled=true
scanner.events.user.journey.simulation=true
scanner.events.ecommerce.simulation=true

# ==================== HYPERLINK AND NAVIGATION ====================

# Enhanced Hyperlink Processing
scanner.hyperlinks.enabled=true
scanner.hyperlinks.priority.max=5
scanner.hyperlinks.navigation.max=3
scanner.hyperlinks.subdomain.max=3
scanner.hyperlinks.timeout.seconds=20
scanner.hyperlinks.aggressive.discovery=true

# Subdomain Discovery
scanner.subdomain.discovery.enabled=true
scanner.subdomain.common.patterns=www,api,app,mobile,m,accounts,secure,login,auth,analytics,tracking,admin,dashboard
scanner.subdomain.discovery.timeout=20

# ==================== COOKIE COLLECTION STRATEGY ====================

# Multi-Phase Cookie Collection - Optimized for performance
scanner.cookie.collection.phases=1
scanner.cookie.collection.interval.ms=1500
scanner.cookie.deduplication.enabled=true
scanner.cookie.incremental.save=true
scanner.cookie.header.monitoring=true
scanner.cookie.javascript.monitoring=true

# Enhanced Cookie Detection
scanner.cookie.detection.aggressive=true
scanner.cookie.detection.all.headers=true
scanner.cookie.detection.session.tracking=true
scanner.cookie.detection.auth.tracking=true

# ==================== BROWSER TIMEOUTS ====================

# Browser Launch Configuration
scanner.browser.launch.timeout.ms=30000

# Context Timeouts
scanner.context.default.timeout.ms=15000
scanner.context.navigation.timeout.ms=15000

# ==================== NAVIGATION TIMEOUTS ====================
# Progressive Navigation Timeouts (fallback strategy)

scanner.navigation.networkidle.timeout.ms=20000
scanner.navigation.domcontentloaded.timeout.ms=15000
scanner.navigation.load.timeout.ms=10000

# ==================== WAIT TIMEOUTS ====================
# Page Load Waits
scanner.wait.initial.load.ms=500
scanner.wait.embedded.content.ms=1500
scanner.wait.external.resources.ms=2000

# Consent Handling Waits
scanner.wait.consent.handled.ms=2500

# User Interaction Waits
scanner.wait.scroll.delay.ms=1000

# Analytics & Tracking Waits
scanner.wait.analytics.trigger.ms=1500
scanner.wait.cookie.sync.ms=4000

# ==================== BROWSER AND PERFORMANCE - OPTIMIZED FOR STABILITY ====================

# Browser Configuration for Maximum Compatibility and Resource Management
scanner.browser.pool.size=1
scanner.browser.reuse.enabled=false
scanner.memory.cleanup.enabled=true
scanner.resource.timeout.minutes=10
scanner.browser.launch.args=--no-sandbox,--disable-setuid-sandbox,--disable-dev-shm-usage,--disable-web-security

# Performance Settings
scanner.performance.monitoring=true
scanner.performance.detailed.logging=false
scanner.network.monitoring.enabled=true
scanner.response.detailed.logging=false

# ==================== SECURITY AND PRIVACY ====================

# Security Settings (Disabled for maximum tracking detection)
scanner.privacy.mode=disabled
scanner.user.data.collection=true
scanner.geolocation.enabled=true
scanner.notifications.enabled=true
scanner.dnt.header=false

# ==================== EXTERNAL SERVICES ====================

# Cookie Categorization API Configuration
cookie.categorization.api.url=http://10.173.184.34:9014/predict
cookie.categorization.api.connect.timeout=15000
cookie.categorization.api.read.timeout=45000

# Cache Configuration
cookie.categorization.cache.enabled=true
cookie.categorization.cache.ttl.minutes=120

# Retry Configuration - ALL CONFIGURABLE
cookie.categorization.retry.maxAttempts=3
cookie.categorization.retry.delay=1000
cookie.categorization.retry.multiplier=2.0
cookie.categorization.retry.maxDelay=10000

# Cookie Categorization Mode
cookie.categorization.use-external-api=${USE_AI:true}

# ==================== SPRING CONFIGURATION WITH PROTECTION ====================

# Application Settings
spring.application.name=protected-cookie-scanner-multitenant

# Enhanced Async Configuration for Parallel Processing with Limits
spring.task.execution.pool.core-size=4
spring.task.execution.pool.max-size=8
spring.task.execution.pool.queue-capacity=50
spring.task.execution.pool.keep-alive=60s
spring.task.execution.thread-name-prefix=scanner-async-

# HTTP Client Configuration
spring.http.client.timeout.connect=15000
spring.http.client.timeout.read=30000

# ==================== RESILIENCE4J CIRCUIT BREAKER CONFIGURATION ====================

# Circuit Breaker for Scan Service
resilience4j.circuitbreaker.instances.scanService.register-health-indicator=true
resilience4j.circuitbreaker.instances.scanService.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.scanService.minimum-number-of-calls=10
resilience4j.circuitbreaker.instances.scanService.sliding-window-size=20
resilience4j.circuitbreaker.instances.scanService.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.scanService.permitted-number-of-calls-in-half-open-state=5
resilience4j.circuitbreaker.instances.scanService.slow-call-rate-threshold=50
resilience4j.circuitbreaker.instances.scanService.slow-call-duration-threshold=10s

# Circuit Breaker for External Categorization API
resilience4j.circuitbreaker.instances.categorizationService.register-health-indicator=true
resilience4j.circuitbreaker.instances.categorizationService.failure-rate-threshold=60
resilience4j.circuitbreaker.instances.categorizationService.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.categorizationService.sliding-window-size=10
resilience4j.circuitbreaker.instances.categorizationService.wait-duration-in-open-state=20s
resilience4j.circuitbreaker.instances.categorizationService.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.categorizationService.slow-call-rate-threshold=70
resilience4j.circuitbreaker.instances.categorizationService.slow-call-duration-threshold=15s

# ==================== RATE LIMITING CONFIGURATION ====================

# Rate Limiting Settings
rate-limit.requests-per-minute=100
rate-limit.burst-capacity=10
rate-limit.enabled=false

# ==================== TENANT-AWARE LOGGING CONFIGURATION ====================

# Enhanced Logging for Error Tracking and Protection with Tenant Support
logging.level.com.example.scanner=INFO
logging.level.com.example.scanner.service.ScanService=DEBUG
logging.level.com.example.scanner.service.CookieCategorizationService=INFO
logging.level.com.example.scanner.config.RateLimitInterceptor=INFO
logging.level.com.example.scanner.service.EnhancedScanService=INFO
logging.level.com.example.scanner.exception.GlobalExceptionHandler=INFO
logging.level.com.example.scanner.config.MultiTenantMongoConfig=INFO
logging.level.io.github.resilience4j=INFO
logging.level.org.springframework.retry=INFO
logging.level.com.microsoft.playwright=WARN
logging.level.org.springframework.web.servlet.DispatcherServlet=INFO

# SECURITY LOGGING - Track path traversal attempts
logging.level.com.example.scanner.config.PathTraversalSecurityFilter=WARN
logging.level.com.example.scanner.config.InvalidCharacterFilter=WARN
logging.level.com.example.scanner.controller.CustomErrorController=WARN

# Multi-Tenant specific logging
logging.level.com.example.scanner.config.TenantAwareMongoDbFactory=DEBUG
logging.level.com.example.scanner.config.TenantAwareMongoTemplate=DEBUG

# Console logging pattern for better readability with request tracking and tenant info
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%X{traceId:-},%X{spanId:-},%X{tenantId:-}] %logger{36} - %msg%n

# ==================== MONITORING AND MANAGEMENT ====================

# Swagger/OpenAPI Configuration
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.try-it-out-enabled=true

# Enhanced Management Endpoints with Protection Monitoring
management.endpoints.web.exposure.include=health,info,metrics,prometheus,circuitbreakers,ratelimiters,env,loggers,tenants
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always
management.endpoint.metrics.enabled=true
management.endpoint.circuitbreakers.enabled=true

# Health Check Configuration
management.health.circuitbreakers.enabled=true
management.health.diskspace.enabled=true
management.health.mongo.enabled=true

# Multi-Tenant Health Checks
management.health.tenant-databases.enabled=true
management.health.shared-database.enabled=true

# Metrics Export with Protection Metrics
management.metrics.export.prometheus.enabled=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.percentiles.http.server.requests=0.5,0.9,0.95,0.99

# JVM Metrics
management.metrics.enable.jvm=true
management.metrics.enable.system=true
management.metrics.enable.process=true

# Custom Application Metrics with Tenant Tagging
management.metrics.tags.application=protected-cookie-scanner-multitenant
management.metrics.tags.environment=production

# Custom management endpoints
management.endpoint.cookies.enabled=true
management.endpoint.scans.enabled=true
management.endpoint.tenants.enabled=true

# ==================== GRACEFUL SHUTDOWN ====================

# Graceful Shutdown Configuration
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=30s

# ==================== EXPERIMENTAL FEATURES - REDUCED FOR STABILITY ====================

# Experimental Cookie Detection Features (reduced for stability)
scanner.experimental.ai.detection=false
scanner.experimental.machine.learning=false
scanner.experimental.behavioral.analysis=false
scanner.experimental.pattern.recognition=true

# Advanced Network Interception (reduced for stability)
scanner.experimental.network.interception=true
scanner.experimental.request.modification=false
scanner.experimental.response.caching=true

# ==================== DEBUGGING AND DEVELOPMENT ====================

# Development Settings (optimized for production stability)
scanner.debug.mode=false
scanner.debug.save.pages=false
scanner.debug.save.network.logs=false
scanner.debug.detailed.timing=false

# Test Mode Settings
scanner.test.mode=false
scanner.test.mock.responses=false
scanner.test.bypass.external.calls=false

# Multi-Tenant Debug Settings
multi-tenant.debug.database-creation=true
multi-tenant.debug.tenant-switching=true

# Additional Spring Boot debug for multi-tenant setup
logging.level.org.springframework.web.servlet.config.annotation=DEBUG
logging.level.org.springframework.context=DEBUG
logging.level.com.example.scanner.config=DEBUG
logging.level.org.springframework.data.mongodb=DEBUG

# ==================== API CONFIGURATION ====================

# API Configuration for future versioning with tenant support
api.base.path=/api
api.version=v1
api.context.path=${api.base.path}/${api.version}

# ==================== TENANT ISOLATION & SECURITY ====================

# Tenant Isolation Settings
multi-tenant.isolation.strict-mode=true
multi-tenant.security.tenant-validation=true
multi-tenant.security.cross-tenant-access-prevention=true

# Tenant Database Management
multi-tenant.database.auto-create=true
multi-tenant.database.auto-migration=true
multi-tenant.database.cleanup.enabled=false
multi-tenant.database.cleanup.retention-days=365

# Tenant-specific caching
multi-tenant.cache.per-tenant=true
multi-tenant.cache.shared-data=true

# ==================== PERFORMANCE OPTIMIZATION FOR MULTI-TENANT ====================

# Connection pooling per tenant
multi-tenant.connection-pool.per-tenant=false
multi-tenant.connection-pool.shared=true
multi-tenant.connection-pool.max-idle-time=300000

# Query optimization
multi-tenant.query.optimization=true
multi-tenant.query.tenant-indexing=true

# ==================== TENANT MANAGEMENT ====================

# Default tenant settings
multi-tenant.default-tenant.enabled=true
multi-tenant.tenant-header-name=X-Tenant-ID
multi-tenant.tenant-parameter-name=tenantId

# Tenant validation
multi-tenant.tenant-validation.strict=true
multi-tenant.tenant-validation.allow-default=true

# ==================== CONSENT HANDLE EXPIRY ====================
consent.handle.expiry.minutes=15

# Audit Service Configuration
audit.service.base-url=${AUDIT_MODULE_APIS_URL:http://audit-module-apis:9006}/audit
audit.service.endpoint=/v1/audit

# ==================== CORS CONFIGURATION ====================
cors.allowed-origins=*
cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS,PATCH
cors.allowed-headers=*
cors.allow-credentials=true
cors.max-age=3600

# ==================== VAULT SERVICE CONFIGURATION ====================
vault.service.base-url=%30https://api.dscoe.jiolabs.com:8443/negdvault/client
vault.service.sign-endpoint=/sign
vault.service.verify-endpoint=/verify
vault.service.endpoints.encryptPayload=/encryptPayload

# External Service Configuration
notification.service.base.url=${NOTIFICATION_MODULE_APIS_URL:http://notification-module-apis:9005}
notification.service.endpoints.trigger-event=/notification/v1/events/trigger


